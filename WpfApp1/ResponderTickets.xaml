<Window x:Class="UI.Views.ResponderTickets"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Responder Tickets"
        Height="700" Width="1000"
        Background="#f2f2f2"
        WindowStartupLocation="CenterScreen">

    <Border CornerRadius="10" Background="White" Margin="20" Padding="20" BorderBrush="#ccc" BorderThickness="1">
        <Grid>

            <!-- MENU INICIAL -->
            <StackPanel x:Name="MainMenu" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Visible">
                <TextBlock Text="Bem-vindo, Técnico" FontSize="22" FontWeight="Bold" Foreground="#274360" Margin="0 0 0 20" HorizontalAlignment="Center"/>
                <Button Content="Responder Tickets" Width="250" Height="40" Margin="0,10" Background="#274360" Foreground="White" BorderBrush="#274360" Click="BtnResponderTickets_Click"/>
                <Button Content="Ver Mapas" Width="250" Height="40" Margin="0,10" Background="#274360" Foreground="White" BorderBrush="#274360" Click="BtnVerMapas_Click"/>
                <Button Content="Logout" Width="250" Height="40" Margin="0,10" Background="#d9534f" Foreground="White" BorderBrush="#d9534f" Click="BtnLogout_Click"/>
            </StackPanel>

            <!-- RESPOSTA A TICKETS -->
            <StackPanel x:Name="ResponderSection" Visibility="Collapsed">

                <!-- Filtros Modernos -->
                <Border Background="#f5f5f5" Padding="10" CornerRadius="6" Margin="0,0,0,10">
                    <DockPanel>

                        <!-- Botão à direita -->
                        <Button Content="Aplicar Filtros"
                    Width="150"
                    Height="30"            
                    Background="#274360"
                    Foreground="White"
                    BorderBrush="#274360"
                    Click="BtnAplicarFiltros_Click"
                    DockPanel.Dock="Right"
                    Margin="10,0,0,0"/>

                        <!-- Filtros à esquerda -->
                        <WrapPanel VerticalAlignment="Center" HorizontalAlignment="Left" ItemHeight="35" ItemWidth="170">

                            <StackPanel Margin="0,0,10,0">
                                <TextBlock Text="Tipo" FontWeight="Bold" FontSize="12"/>
                                <ComboBox Width="150" Height="30" SelectedItem="{Binding FiltroTipo}" Padding="5" Background="White" BorderBrush="#ccc" BorderThickness="1">
                                    <ComboBox.ItemsSource>
                                        <x:Array Type="{x:Type sys:String}">
                                            <sys:String>Todos</sys:String>
                                            <sys:String>Hardware</sys:String>
                                            <sys:String>Software</sys:String>
                                        </x:Array>
                                    </ComboBox.ItemsSource>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Margin="0,0,10,0">
                                <TextBlock Text="Prioridade" FontWeight="Bold" FontSize="12"/>
                                <ComboBox Width="150" Height="30" SelectedItem="{Binding FiltroPrioridade}" Padding="5" Background="White" BorderBrush="#ccc" BorderThickness="1">
                                    <ComboBox.ItemsSource>
                                        <x:Array Type="{x:Type sys:String}">
                                            <sys:String>Todos</sys:String>
                                            <sys:String>Baixa</sys:String>
                                            <sys:String>Média</sys:String>
                                            <sys:String>Alta</sys:String>
                                        </x:Array>
                                    </ComboBox.ItemsSource>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Margin="0,0,10,0">
                                <TextBlock Text="Estado Ticket" FontWeight="Bold" FontSize="12"/>
                                <ComboBox Width="150" Height="30" SelectedItem="{Binding FiltroEstadoTicket}" Padding="5" Background="White" BorderBrush="#ccc" BorderThickness="1">
                                    <ComboBox.ItemsSource>
                                        <x:Array Type="{x:Type sys:String}">
                                            <sys:String>Todos</sys:String>
                                            <sys:String>porAtender</sys:String>
                                            <sys:String>emAtendimento</sys:String>
                                            <sys:String>atendido</sys:String>
                                        </x:Array>
                                    </ComboBox.ItemsSource>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Margin="0,0,10,0">
                                <TextBlock Text="Estado Atendimento" FontWeight="Bold" FontSize="12"/>
                                <ComboBox Width="150" Height="30" SelectedItem="{Binding FiltroEstadoAtendimento}" Padding="5" Background="White" BorderBrush="#ccc" BorderThickness="1">
                                    <ComboBox.ItemsSource>
                                        <x:Array Type="{x:Type sys:String}">
                                            <sys:String>Todos</sys:String>
                                            <sys:String>aberto</sys:String>
                                            <sys:String>naoResolvido</sys:String>
                                            <sys:String>resolvido</sys:String>
                                        </x:Array>
                                    </ComboBox.ItemsSource>
                                </ComboBox>
                            </StackPanel>

                        </WrapPanel>
                    </DockPanel>
                </Border>

                <!-- Tabela de Tickets -->
                <DataGrid ItemsSource="{Binding Tickets}"
              SelectedItem="{Binding TicketSelecionado, Mode=TwoWay}"
              AutoGenerateColumns="False"
              Height="300"
              Margin="0,0,0,10">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="40"/>
                        <DataGridTextColumn Header="Tipo" Binding="{Binding Tipo}" Width="100"/>
                        <DataGridTextColumn Header="Subtipo" Binding="{Binding SubtipoProblema}" Width="100"/>
                        <DataGridTextColumn Header="Prioridade" Binding="{Binding Prioridade}" Width="100"/>
                        <DataGridTextColumn Header="Descrição" Binding="{Binding Descricao}" Width="200"/>
                        <DataGridTextColumn Header="Estado Ticket" Binding="{Binding EstadoTicket}" Width="100"/>
                        <DataGridTextColumn Header="Estado Atendimento" Binding="{Binding EstadoAtendimento}" Width="120"/>
                        <DataGridTextColumn Header="Data Criação" Binding="{Binding DataCriacao, StringFormat={}{0:dd/MM/yyyy HH:mm}}" Width="120"/>
                        <DataGridTextColumn Header="Data Atendimento" Binding="{Binding DataAtendimento, StringFormat={}{0:dd/MM/yyyy HH:mm}}" Width="130"/>
                        <DataGridTextColumn Header="Data Conclusão" Binding="{Binding DataConclusao, StringFormat={}{0:dd/MM/yyyy HH:mm}}" Width="130"/>
                        <DataGridTextColumn Header="Funcionário" Binding="{Binding NomeFuncionario}" Width="150"/>
                        <DataGridTextColumn Header="Detalhes Técnico" Binding="{Binding DetalhesTecnico}" Width="200"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Botões -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Responder Ticket"
                Width="150"
                Margin="0,0,10,0"
                Command="{Binding ResponderCommand}"
                Background="#274360"
                Foreground="White"
                BorderBrush="#274360"/>
                    <Button Content="Voltar"
                Width="100"
                Click="BtnVoltar_Click"/>
                </StackPanel>
            </StackPanel>


            <!-- MAPA/ESTATÍSTICAS -->
            <StackPanel x:Name="MapaSection" Visibility="Collapsed" Margin="10">
                <TextBlock Text="Estatísticas dos Tickets respondidos" FontSize="20" FontWeight="Bold" Foreground="#274360" Margin="0,0,0,10"/>
                <StackPanel Orientation="Horizontal" Margin="0,10">
                    <TextBlock Text="Data Início:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <DatePicker SelectedDate="{Binding DataInicioFiltro}" Width="120"/>
                    <TextBlock Text="Data Fim:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                    <DatePicker SelectedDate="{Binding DataFimFiltro}" Width="120"/>
                </StackPanel>

                <Button Content="Aplicar Filtros" Width="120" Margin="0,10" Click="BtnAplicarFiltros_Click1" Background="#274360" Foreground="White" BorderBrush="#274360"/>

                <TextBlock Text="{Binding TotalTickets, StringFormat=Total de Tickets: {0}}" FontSize="14" Margin="0,5"/>
                <TextBlock Text="{Binding TicketsAtendidos, StringFormat=Tickets Atendidos: {0}}" FontSize="14" Margin="0,2"/>
                <TextBlock Text="{Binding TicketsResolvidos, StringFormat=Tickets Resolvidos: {0}}" FontSize="14" Margin="0,2"/>
                <TextBlock Text="{Binding TicketsNaoResolvidos, StringFormat=Tickets Não Resolvidos: {0}}" FontSize="14" Margin="0,2"/>

                <TextBlock Text="Percentagens:" FontWeight="Bold" Margin="10,15,0,5"/>
                <TextBlock Text="{Binding PercentualRespondidos, StringFormat=Respondidos: {0}}" FontSize="14" Margin="0,2"/>
                <TextBlock Text="{Binding PercentualResolvidosVsAtendidos, StringFormat=Resolvidos / Atendidos: {0}}" FontSize="14" Margin="0,2"/>
                <TextBlock Text="{Binding PercentualResolvidosVsNaoResolvidos, StringFormat=Resolvidos / (Total): {0}}" FontSize="14" Margin="0,2"/>

                <TextBlock Text="Média de Tempo de Atendimento por Tipo:" FontWeight="Bold" Margin="10,15,0,5"/>
                <ItemsControl ItemsSource="{Binding MediaTempoAtendimentoPorTipoLista}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock FontSize="14" Margin="0,2">
                                <Run Text="{Binding Tipo}" />
                                <Run Text=": " />
                                <Run Text="{Binding MediaTempoFormatada, Mode=OneWay}" />
                            </TextBlock>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Button Content="Voltar" Width="100" HorizontalAlignment="Right" Margin="0,10,0,0" Click="BtnVoltar_Click"/>
            </StackPanel>

        </Grid>
    </Border>
</Window>
